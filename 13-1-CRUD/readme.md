# CRUD

делаем бэкенд

- Пакет json-server https://github.com/typicode/json-server
- Postman/Postwoman/Insomnia и т. д.
- Работа с приватным API
  - Create
    - Метод POST
    - Тело
    - Заголовки
    - Ответ
  - Read
    - Метод GET
    - Ответ
  - Update
    - Методы PUT и PATCH
    - Тело
    - Заголовки
    - Ответ
  - Delete
    - Метод DELETE
    - Ответ
  - Цикл запрос-ответ

---

- json-server - это фейк rust api (не настоящий бекенд для использование только
  в разработке), под капотом webpack, работает только в проекте и бд в файле
  db.json

- в json'e объект, а в нём свойство books - значит при запуске сервера в
  Resources возвращать будет http://localhost:4040/books (все свойства, что
  указаны будут выведены через /)

- для старта запускаем команду в скрипте json-server --watch db.json

- в запросе есть куча опций, например сортировка пришедших данных по (рейтинг,
  id и т.п.)

  - http://localhost:4040/books?\_sort=rating&\_order=asc (вместо rating можно
    другие имеющиеся свойства, остальное не трогаем)
    - asc - по-убыванию, disc - по-возрастанию

- postman - внешний http-клиент (в VS-code тоже есть в расширениях). Нужен для
  быстрых запросов без методов fetch(). Используют при разработке и тестировании
  бекенда
- options лучше не инлайнить, т.к. они могут быть большими

------------------------------ GET -------------------------------------------

- выбираем метод GET, чтоб получить запрос
- в случае, если порт занят, у каждого пакета есть свой CLI - command line
  interface - ищем флаги --port (-p), --delay (-d)

- fetch'и не должны стоять голым кодом, они должны быть в отдельных ф-циях и в
  отдельных файлах
- SCREAMING_CASE - кричащий кейс, используется для CONST, означает - не менять!

------------------------------ POST -------------------------------------------

- когда отсылаем что-то на бекенд, то в postman dj вкладке body нужно выбрать
  raw и тип JSON
  - во вкладке Headers - KEY: Content-type | VALUE: application/json - чтобы
    бекенд знал, что от тебя принимает?
  - не пишем id, потому что id выдаётся бекендом автоматически
  - отправляем и смотрим - статус, содержимое ответа (id уникален и ставится )
- создаём файл "с - post.js" в котором прописываем наш код для отправки нового
  экземпляра книги экземпляр книги нужно привести из объекта в строку, используя
  метод JSON.stringify()
- 3 отличия от GET - метод, хэдеры, body
- catch() нужен всегда и лучше ставить вконце вызова ф-ции (результат вызова
  then())

------------------------------ PUT/PATCH -------------------------------------

- PUT - удалить старое и установка нового. PATCH - добавление нового
- те же настройки, что и у POST, только в body-raw-json надо прописать то, что
  хотим обновить {title: "Большая тестовая книга по CSS"}
- а так же адрес по id того объекта, который надо изменить
- http методы пишутся большими буквами
- создаём файл js с ф-цией обновления

------------------------------ DELETE ----------------------------------------

- при удалении не нужно ничего отправлять в postman, а только выбрать метод
  DELETE и /id
- создаём файл с ф-цией удаления
- не хотим никогда удалять свойства!

---

--- отслеживание ошибки ---

fetch('').then(response => { if (response.ok) { return response.json(); }

    throw new Error(response.statusText);

})

- если делаешь запрос книг, а книг не осталось - должен возвращаться пустой
  массив, а если оно не знает, что такое книги, то тогда 404
